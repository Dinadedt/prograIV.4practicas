<!DOCTYPE html><!--definision de tipo de documento-->
<html lang="en"><!--apertura de la pagina html-->
<head><!--encabesado de la pagina html-->
    <meta charset="UTF-8"><!--codificasion de caracteres espesiales-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge"><!--IE-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <title>::.. APP DE LIBROS ..::</title>
</head>

<body><!--contenido de la pagina html-->

<div class="container" id="app">
  <div class="row justify-content-md-center">
    <div classs="col-12 col-md-6">
      <div class="card border-primary" >
        <div class="card-header bg-primary text-white"> BUSCAR LIBROS</div>
        <div class="card-body">
          <form id="frmLibro" @sudmit.prevent="guardarLibro" @reset.prevent="nuevoLibro()">
            <div class="row p-1" >
                <div class="col-3 col-md-2">Autor :</div>
                <div class="col-9 col-md-3">
                  <input class="form-control" type="text" v-model="libro.autor" name="txtNombreLibro" id="txtNombreLibro">
                </div>
              </div>
            <div class="row p-1" >
              <div class="col-3 col-md-2">idAutor :</div>
              <div class="col-9 col-md-3">
                <input class="form-control" type="text" v-model="libro.idAutor" name="txtidAutorLibro" id="txtidAutorLibro">
            </div>
          </div>
          <div class="row p-1" >
            <div class="col-3 col-md-2">Codigo :</div>
            <div class="col-9 col-md-3">
              <input class="form-control" type="text" v-model="libro.codigo" name="txtCodigoLibro" id="txtCodigoLibro">
          </div>
        </div>
        <div class="row p-1" >
            <div class="col-3 col-md-2">Nonbre :</div>
            <div class="col-9 col-md-3">
              <input class="form-control" type="text" v-model="libro.nonbre" name="txtNonbreLibro" id="txtNonbreLibro">
          </div>
        </div>
        <div class="row p-1">
            <div class="col-3 col-md-2">Pais:</div>
            <div class="col-9 col-md-6">
              <input class="form-control" type="text" v-model="libro.pais" name="txtPaisLibro" id="txtPaisLibro">
            </div>
          </div>
          <div class="row p-1">
            <div class="col-3 col-md-2">Telefono:</div>
            <div class="col-9 col-md-6">
              <input class="form-control" type="text" v-model="libro.telefono" name="txtTelefonoLibro" id="txtTelefonoLibro">
            </div>
          </div>
          <div class="row p-1">
            <div class="col col-md-6">
              <input class="btn btn-success" type="submit" value="Guardar Datos">
            </div>
            <div class="col col-md-6">
              <input class="btn btn-warning" type="reset" value="Nuevo Registro">
            </div>
          </div>
           </form>
        </div>
      </div>
    </div>

    <div class="row ">
        <div class="col-12 col-md-10">
          <div class="card text-bg-light" >
            <div class="card-header" >CONSULTA DE Libros</div>
              <div class="card-body">
              <form>
                <table class="table table-dark table-hover">
                  <thead>
                    <tr>
                      <th>BUSCAR</th>
                      <th colspan="2"><input type="text" @keyup="listarLibro()" class="form-control" 
                        v-model="buscar" placeholder="Buscar por Libro"></th>
                    </tr>
                    <tr>
                      <th>autor</th>
                      <th>idAutor</th>
                      <th>codigo</th>
                      <th>nonbre</th>
                      <th>pais</th>
                      <th>telefono</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="libro in libros" @click='modificarLibro(libro)' :key="libro.idAutor" >
                      <td>{{libro.autor}}</td>
                      <td>{{libro.idAutor}}</td>
                      <td>{{libro.codigo}}</td>
                      <td>{{libro.nonbre}}</td>
                      <td>{{libro.pais}}</td>
                      <td>{{libro.telefono}}</td>
                      <td><button @click.prevent="eliminarLibro(libro)" class="btn btn-danger">Eliminar</button></td>
                    </tr>
                  </tbody>
                </table>
              </form>
            </div>
          </div>
        </div>
      </div>  
    </div>
  </div>
  <br>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  
  <script>
      const {createApp} = Vue;
      createApp({
        data(){
          return{
            db:'',
            buscar:'',
            libros:[],
            accion: 'nuevo',
            libro:{
              autor:'',
              idAutor:'',
              codigo:'',
              nonbre:'',
              pais:'',
              telefono:'',
             
            }
          }
        },

        methods:{
          nuevoLibro(){
            this.accion = 'nuevo';
            this.libro.autor = '';
            this.libro.idAutor = '';
            this.libro.codigo = '';
            this.libro.nonbre = '';
            this.libro.pais = '';
            this.libro.telefono = '';
            
          },
          modificarLibro(libro){
            this.accion = 'modificar';
            this.libro = libro;
            
          },
          guardarLibro(){
            if(this.libro.autor=='' || this.libro.nonbre==''){
            console.log('Por favor ingrese los datos correspondientes');
            return;
          }
          let store = this.abrirStore('tbllibro','readwrite');
          if(this.accion==='nuevo'){
            this.libro.idAutor = new Date().getTime().toString(16); //las cantidad milisegundo y lo convierte en hexadecimal
            
          }
          let query = store.put( JSON.parse( JSON.stringify(this.libro)));
          query.onsuccess = resp=>{
            this.nuevoLibro();
            this.listarLibro();
          };
          query.onerror = err=>{
            console.error('ERROR al guardar libro', err);
          };

            
          },
          eliminarLibro(libro){
            if(confirm(`Esta seguro de eliminar el docente ${libro.nonbre}?`)){
            let store = this.abrirStore('tbllibro','readwrite'),
                req = store.delete(libro.idAutor);
                req.onsuccess = res=>{
                  this.listarLibro();
                };
                req.onerror = err=>{
                  console.error('ERROR al guardar libro')
                };
          }
          },
          listarLibro(){
            let store = this.abrirStore('tbllibro','readonly'),
                data = store.getAll();
            data.onsuccess = resp=>{
              this.libros = data.result.filter(libro=>libro.autor.toLowerCase().indexOf(this.buscar.toLowerCase())>-1 || libro.nonbre.toLowerCase().indexOf(this.buscar.toLowerCase())>-1);
        
            };
          },
          abrirBD(){
            let indexDB = indexedDB.open('db_usis055521_dina',1);
            indexDB.onupgradeneeded = e=>{
              let req = e.target.result,
                tbllibro = req.createObjectStore('tbllibro',{keyPath: 'idAutor'});
                
                
                tbllibro.createIndex('idAutor','idAutor',{unique:true});
              
            };
            indexDB.onsuccess = e=>{
              this.db = e.target.result;
              this.listarLibro();
            };
            indexDB.onerror = e=>{
              console.error('ERROR al crear, abrir la BD',e);
            };
          },
          abrirStore(store,modo){
            let ltx = this.db.transaction(store,modo);
            return ltx.objectStore(store);
          }
        },
        created(){
          this.abrirBD();
          //this.listarlibro();
        }
      }).mount('#app')
    </script>
      
    </body>
    </html>

